<div class="dashboard">
    <!-- Header -->
    <header class="dashboard-header">
        <div class="header-content">
            <h1>Witaj, {{ getUserDisplayName() }}!</h1>
            <div class="header-actions">
                <span class="user-role" [class]="currentUser?.role">{{ currentUser?.role | uppercase }}</span>
                <button class="logout-btn" (click)="logout()">Wyloguj</button>
            </div>
        </div>
    </header>

    <!-- Navigation Tabs -->
    <nav class="dashboard-nav">
        <button class="nav-tab" [class.active]="activeTab === 'overview'" (click)="setActiveTab('overview')">
            PrzeglƒÖd
        </button>
        <button class="nav-tab" [class.active]="activeTab === 'calendar'" (click)="setActiveTab('calendar')">
            Kalendarz
        </button>
        <button class="nav-tab" [class.active]="activeTab === 'search'" (click)="setActiveTab('search')">
            Psychologowie
        </button>
        <button class="nav-tab" [class.active]="activeTab === 'packages'" (click)="setActiveTab('packages')">
            Pakiety
        </button>
    </nav>

    <!-- Loading State -->
    <div class="loading-container" *ngIf="isLoading">
        <div class="spinner"></div>
        <p>≈Åadowanie danych...</p>
    </div>

    <!-- Main Content -->
    <main class="dashboard-content" *ngIf="!isLoading">

        <!-- Overview Tab -->
        <section class="overview-section" *ngIf="activeTab === 'overview'">
            <div class="overview-grid">

                <!-- Package Status Card -->
                <div class="status-card package-status">
                    <div class="card-header">
                        <h3>Status pakietu</h3>
                        <span class="status-icon">üì¶</span>
                    </div>
                    <div class="card-content">
                        <p class="status-text" [class]="currentUserPackage?.status">
                            {{ getPackageStatusText() }}
                        </p>
                        <p class="sessions-text" *ngIf="currentUserPackage">
                            {{ getSessionsText() }}
                        </p>
                        <div class="progress-bar" *ngIf="currentUserPackage">
                            <div class="progress-fill"
                                [style.width.%]="(currentUserPackage.sessionsUsed / currentUserPackage.totalSessions) * 100">
                            </div>
                        </div>
                        <div class="card-actions">
                            <button class="btn btn-primary" (click)="navigateToPackages()" *ngIf="!hasActivePackage()">
                                Kup pakiet
                            </button>
                            <button class="btn btn-secondary" (click)="navigateToPackages()" *ngIf="hasActivePackage()">
                                ZarzƒÖdzaj pakietem
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Upcoming Appointments Card -->
                <div class="status-card appointments-status">
                    <div class="card-header">
                        <h3>NadchodzƒÖce wizyty</h3>
                        <span class="status-icon">üìÖ</span>
                    </div>
                    <div class="card-content">
                        <p class="appointment-text">{{ getUpcomingAppointmentText() }}</p>
                        <div class="appointments-list" *ngIf="upcomingAppointments.length > 0">
                            <div *ngFor="let appointment of upcomingAppointments.slice(0, 3)" class="appointment-item">
                                <div class="appointment-date">
                                    {{ formatDate(appointment.date) }}
                                </div>
                                <div class="appointment-time">
                                    {{ appointment.startTime }} - {{ appointment.endTime }}
                                </div>
                            </div>
                        </div>
                        <div class="card-actions">
                            <button class="btn btn-primary" (click)="navigateToCalendar()">
                                {{ upcomingAppointments.length > 0 ? 'Zobacz wszystkie' : 'Um√≥w wizytƒô' }}
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Assigned Psychologist Card -->
                <div class="status-card psychologist-status">
                    <div class="card-header">
                        <h3>Tw√≥j psycholog</h3>
                        <span class="status-icon">üë©‚Äç‚öïÔ∏è</span>
                    </div>
                    <div class="card-content">
                        <div *ngIf="assignedPsychologist; else noPsychologist">
                            <h4>{{ assignedPsychologist.firstName }} {{ assignedPsychologist.lastName }}</h4>
                            <p class="specializations">
                                {{ assignedPsychologist.specializations.join(', ') }}
                            </p>
                            <div class="rating">
                                <span class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                                <span class="rating-text">{{ assignedPsychologist.rating }}/5</span>
                            </div>
                        </div>
                        <ng-template #noPsychologist>
                            <p>Nie masz jeszcze przypisanego psychologa</p>
                        </ng-template>
                        <div class="card-actions">
                            <button class="btn btn-primary" (click)="navigateToSearch()">
                                {{ assignedPsychologist ? 'Zmie≈Ñ psychologa' : 'Wybierz psychologa' }}
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Quick Stats Card -->
                <div class="status-card stats-card">
                    <div class="card-header">
                        <h3>Statystyki</h3>
                        <span class="status-icon">üìä</span>
                    </div>
                    <div class="card-content">
                        <div class="stat-item">
                            <span class="stat-label">Sesje u≈ºyte:</span>
                            <span class="stat-value">{{ currentUserPackage?.sessionsUsed || 0 }}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Sesje pozosta≈Çe:</span>
                            <span class="stat-value">{{ currentUserPackage?.sessionsRemaining || 0 }}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">NadchodzƒÖce wizyty:</span>
                            <span class="stat-value">{{ upcomingAppointments.length }}</span>
                        </div>
                        <div class="stat-item" *ngIf="currentUserPackage?.isOnCredit">
                            <span class="stat-label">Do sp≈Çaty:</span>
                            <span class="stat-value credit">{{ currentUserPackage.creditBalance }} z≈Ç</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="recent-activity" *ngIf="upcomingAppointments.length > 0">
                <h3>Ostatnia aktywno≈õƒá</h3>
                <div class="activity-list">
                    <div *ngFor="let appointment of upcomingAppointments.slice(0, 5)" class="activity-item">
                        <div class="activity-icon">üìÖ</div>
                        <div class="activity-details">
                            <p class="activity-text">
                                Wizyta um√≥wiona na {{ formatDate(appointment.date) }} o {{ appointment.startTime }}
                            </p>
                            <small class="activity-time">
                                Status: {{ appointment.status === 'scheduled' ? 'Zaplanowana' : appointment.status }}
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Calendar Tab -->
        <section class="calendar-section" *ngIf="activeTab === 'calendar'">
            <app-calendar [userId]="currentUser?.id || ''" (appointmentCreated)="onAppointmentCreated()"></app-calendar>
        </section>

        <!-- Psychologist Search Tab -->
        <section class="search-section" *ngIf="activeTab === 'search'">
            <app-psychologist-search></app-psychologist-search>
        </section>

        <!-- Package Management Tab -->
        <section class="packages-section" *ngIf="activeTab === 'packages'">
            <app-package-management></app-package-management>
        </section>

    </main>

    <!-- Quick Action Buttons (Floating) -->
    <div class="quick-actions" *ngIf="hasActivePackage() && activeTab === 'overview'">
        <button class="quick-action-btn calendar" (click)="navigateToCalendar()" title="Um√≥w wizytƒô">
            üìÖ
        </button>
        <button class="quick-action-btn search" (click)="navigateToSearch()" title="Znajd≈∫ psychologa">
            üîç
        </button>
    </div>
</div>